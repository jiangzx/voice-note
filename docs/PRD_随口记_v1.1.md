# 随口记 App — 产品规格书 (MVP v1.0)

> 版本：v1.1  
> 日期：2026-02-15  
> 状态：需求定稿（第二轮修订）

---

## 1. 产品定位

**随口记**——一款以**语音对话为核心交互**的智能记账助手。用户可通过自然语言快速记账，App 自动理解、提取关键信息并归类。后续版本将扩展到记单词、记日常等场景。

**核心价值主张**：随口一说，账目清楚——最自然的记账方式。

**App 名称**：随口记（SuiKouJi）  
**默认助手名**：小记（用户可自定义修改）  
**Slogan 备选**：「随口一说，生活有数」/「动动嘴，记账不累」

---

## 2. 技术选型

| 项目 | 方案 | 备注 |
|---|---|---|
| **开发框架** | Flutter | 跨平台，iOS + Android 同时覆盖 |
| **语音识别（ASR）** | 阿里云百炼 **qwen3-asr-flash-realtime** | 支持中英文 + 方言，实时流式识别，≤5分钟音频 |
| **ASR 备选** | 阿里云百炼 **paraformer-realtime-v2** | 成熟稳定，0.288元/小时，每月10小时免费额度 |
| **大模型（LLM）** | 阿里云百炼 **qwen-turbo**（千问Flash） | 输入0.3元/百万Token，输出0.6元/百万Token，性价比最优 |
| **LLM 兜底** | **qwen-plus** | 输入1.52元/百万Token，qwen-turbo 无法处理时升级调用 |
| **本地 VAD** | **Silero VAD**（via `vad` Flutter 包） | 设备端语音活动检测，零云端成本，过滤沉默和噪音 |
| **NLP 策略** | 混合方案：**本地规则引擎优先** → 云端 qwen-turbo 兜底 | 离线可用基础能力，联网时体验更佳 |
| **本地存储** | SQLite（via drift / sqflite）或 Hive | 结构化数据优先 SQLite |
| **云同步后端** | **阿里云 AnalyticDB Supabase**（托管版） | 中国大陆机房，<50ms 延迟，数据合规 |
| **后端 SDK** | `supabase_flutter` | Auth / Database / Storage / Edge Functions / Realtime 全覆盖 |
| **消息推送** | iOS: APNs；Android: **极光推送（JPush）/ 个推** | 覆盖国内所有 Android 厂商通道 |
| **状态管理** | Riverpod 或 Bloc | 根据团队偏好选择 |
| **唤起方式** | ① 桌面 Widget（`home_widget`）② iOS 快捷指令（URL Scheme）③ Android 通知栏快捷入口 | 详见第 5.1 节 |

---

## 3. 用户体系

### 3.1 账号策略

- **可选注册**：首次使用无需登录，数据存本地
- 登录后开启云同步，支持多设备数据共享

### 3.2 登录方式

- 手机号验证码登录
- 微信登录
- Apple ID 登录（iOS 上架必须支持）

### 3.3 安全与隐私

- 本地数据加密存储
- 云端传输全程 HTTPS（阿里云 AnalyticDB Supabase，数据存储在中国大陆）
- 语音数据仅用于识别，不做云端留存（需在隐私政策中说明）
- 符合《个人信息保护法》及应用商店合规要求

---

## 4. 记账模块功能清单

### 4.1 基础记录

| 功能 | 说明 |
|---|---|
| **收支类型** | 支出 / 收入 / 转账 |
| **币种** | MVP 阶段默认人民币（CNY），多币种支持后续版本添加 |
| **必填字段** | 金额、分类（仅 2 个必填） |
| **自动填充** | 日期默认今天（提供今天/昨天/前天快捷选择），描述可选填 |
| **智能推荐** | 最近使用的分类优先排序；午餐时间自动高亮"餐饮"等时段推荐 |
| **缺失追问** | 小记检测到缺少必填项时主动提醒补全 |

### 4.2 账户管理

采用**渐进式披露**设计，最小化用户心智负担：

- **默认体验**：所有交易归入一个隐含的"钱包"账户，用户无需了解"账户"概念即可完成记账
- **可选多账户**：用户可在设置中开启"多账户管理"功能，之后可自定义添加 / 编辑 / 删除账户（如微信、支付宝、银行卡等）
- **转账**：采用单账户视角记录——用户只需指定一个账户和资金方向（转入/转出），可选填对方信息（其他账户名或人名）。支持单侧独立记录，无需强制指定转出和转入双端

### 4.3 分类体系

**预定义支出分类（12 个，其中 10 个默认可见 + 2 个初始隐藏）**：

| 分类 | 图标建议 | 默认状态 |
|---|---|---|
| 餐饮 | 🍜 | 可见 |
| 交通 | 🚗 | 可见 |
| 购物 | 🛒 | 可见（含日用品、美容护肤等） |
| 账单 | 💳 | 可见（含水电燃气、通讯、保险等固定支出） |
| 娱乐 | 🎮 | 可见（含运动健身） |
| 医疗 | 🏥 | 可见 |
| 教育 | 📚 | 可见 |
| 住房 | 🏠 | 可见（房租/房贷） |
| 人情往来 | 🎁 | 可见 |
| 其他 | 📝 | 可见 |
| 宠物 | 🐾 | 初始隐藏（用户可自行开启） |
| 旅行 | ✈️ | 初始隐藏（用户可自行开启） |

**预定义收入分类（5 个）**：

| 分类 | 图标建议 |
|---|---|
| 工资 | 💰 |
| 奖金 | 🏆 |
| 兼职 | 💼 |
| 红包 | 🧧 |
| 其他 | 📝 |

**自定义分类**：
- 用户可通过语音或手动创建新分类
- 分类支持选择图标和颜色标记
- 支持排序、编辑、删除（预设分类可隐藏不可删除）

### 4.4 预算管理

- 支持按**分类**设置月度预算
- **超支提醒**：
  - 消费达到预算 **80%** 时推送预警通知
  - 消费达到预算 **100%** 时推送超支通知
- 预算概览页展示各分类用量进度条

### 4.5 统计报表

**时间维度**：日 / 周 / 月 / 年

**图表类型**：

| 图表 | 用途 |
|---|---|
| 饼图 | 各分类支出 / 收入占比 |
| 柱状图 | 每日 / 每月收支对比 |
| 趋势折线图 | 收支走势变化 |
| 同期对比 | 月 vs 月、年 vs 年 |

- 支持按**账户**、**分类**筛选
- 支持切换收入 / 支出视角

### 4.6 数据导出

支持将账本数据导出到本地，三种格式：

| 格式 | 用途 | 说明 |
|---|---|---|
| **CSV** | Excel 打开、表格分析 | 标准逗号分隔，UTF-8 编码（兼容 WPS/Excel） |
| **PDF** | 打印、存档、分享 | 自动生成带图表的月度/年度报表 |
| **JSON** | 开发者/数据迁移 | 完整结构化数据，便于导入其他系统 |

**导出范围**：支持按时间段（自定义起止日期）、账户、分类筛选后导出  
**导出入口**：统计页右上角导出按钮 + 设置页「数据管理」

---

## 5. 语音交互设计

### 5.1 唤起流程

**三种唤起入口（MVP）**：

#### ① 桌面 Widget（iOS + Android，主推）

```
用户点击主屏幕 Widget 上的"语音记账"按钮
              ↓
      App 打开 → 直接进入语音记账页（监听态）
              ↓
      小记："你好，想记点什么？"（TTS）
```

- 使用 `home_widget` Flutter 包实现
- Widget 样式：显示今日收支概览 + 大号"开始记账"按钮
- 支持 iOS 14+ / Android 4.4+

#### ② iOS 快捷指令（Siri 唤起）

```
用户对 Siri 说 "打开随口记" / "我要记账"
              ↓
      Siri 通过 URL Scheme (suikouji://record) 唤起 App
              ↓
      App 打开 → 进入语音记账页（监听态）
```

- App 注册 URL Scheme：`suikouji://`
- 支持的路径：`suikouji://record`（记账）、`suikouji://stats`（统计）
- App 内提供"添加到快捷指令"一键引导页

#### ③ Android 通知栏快捷入口

```
常驻通知栏显示"随口记 - 点击快速记账"
              ↓
      用户点击通知 → App 打开语音记账页（监听态）
```

- 使用 `flutter_local_notifications` 实现前台常驻通知
- 用户可在设置中开关此功能
- 低电耗，不监听麦克风

#### 后续版本计划

| 版本 | 唤起增强 |
|---|---|
| v1.1+ | **Picovoice Porcupine** 离线唤醒词引擎：App 前台时监听自定义唤醒词"随口记"，纯设备端运行，支持中文 |
| v2.0+ | 对接小米小爱 / 华为小艺等国产语音助手（各厂商标准不统一，需逐个适配） |

### 5.2 语音交互核心架构：本地 VAD + 云端 ASR

#### 设计原则

> **用户不需要按任何按钮即可开始说话。**
> App 通过本地 VAD（语音活动检测）自动判断用户是否在说话，只有检测到人声时才启动云端 ASR，沉默时云端零消耗。

#### 技术分层

```
┌────────────────────────────────────────────────┐
│  麦克风音频流（持续采集）                          │
└──────────────────┬─────────────────────────────┘
                   ↓
┌────────────────────────────────────────────────┐
│  本地 VAD（Silero VAD，设备端运行）                │
│  - 每 20ms 分析一帧音频                           │
│  - 判断：有人声？ → yes / no                      │
│  - 功耗极低（~2-5% CPU），零网络请求               │
└──────────┬───────────────────┬──────────────────┘
           │ 检测到人声          │ 持续静默
           ↓                    ↓
┌──────────────────┐   ┌──────────────────┐
│ 启动云端 ASR 流式  │   │ 不发送任何请求     │
│ 传输（按时长计费） │   │ （零成本等待）     │
└──────────────────┘   └──────────────────┘
```

#### 四层状态机

| 状态 | 英文 | 麦克风 | 本地 VAD | 云端 ASR | 云端费用 | 用户界面表现 |
|---|---|---|---|---|---|---|
| **待机态** | IDLE | ❌ 关闭 | ❌ | ❌ | 零 | 首页，显示今日收支概览 |
| **监听态** | LISTENING | ✅ 开启 | ✅ 运行中 | ❌ 未连接 | **零** | 语音记账页，柔和脉冲动画提示"我在听" |
| **识别态** | RECOGNIZING | ✅ | ✅ | ✅ 流式传输 | 按时长计费 | 声波动画 + 实时显示识别文字 |
| **确认态** | CONFIRMING | ✅ | ✅ 运行中 | ❌ 断开 | **零** | 确认卡片展示，等待语音/点击确认 |

**状态流转：**

```
                    用户进入语音记账页
                          ↓
┌─────────┐         ┌──────────┐   VAD检测到人声   ┌──────────────┐
│  待机态  │ ──────→│  监听态  │ ──────────────→ │   识别态      │
│  IDLE   │         │ LISTENING │                  │ RECOGNIZING  │
└─────────┘         └──────────┘                  └──────────────┘
     ↑                 ↑     ↑                          │
     │          静音<800ms   │                     ASR返回结果
     │         (仍在说话)     │                     NLP解析完成
     │                       │                          ↓
     │  3分钟超时             │                   ┌──────────────┐
     │←─────────────────────│←── "对的/还有" ──│   确认态      │
     │  自动保存退出          │    继续监听        │ CONFIRMING   │
                             │                   └──────────────┘
                             │                          │
                             │←── 保存成功 ─────────────│
                             │    "记好了，还有吗？"
```

#### VAD 关键参数配置

| 参数 | 推荐值 | 说明 |
|---|---|---|
| **检测阈值** | 0.5 | 平衡灵敏度与防误触（0=极灵敏，1=极严格） |
| **语音起始缓冲** | 300ms | 检测到人声后回溯 300ms 确保不丢开头音节 |
| **静音判定时长** | 800ms | 静默超过 800ms 判定为一句话结束 |
| **最小语音时长** | 500ms | 低于 500ms 的声音视为噪音误触，不启动 ASR |

#### ASR 端点检测（服务端补充）

Qwen3-ASR-Flash-Realtime 内置服务端 VAD，作为二级保障：

| 参数 | 推荐值 | 说明 |
|---|---|---|
| `enable_turn_detection` | true | 启用服务端 VAD |
| `turn_detection_silence_duration_ms` | 600ms | 服务端静音判定（比本地略短，避免重复等待） |
| `turn_detection_threshold` | 0.0 | 服务端检测灵敏度（本地已过滤，服务端可放宽） |

### 5.3 智能混合记账流程

#### 场景一：信息完整，一句话搞定（零点击完成）

```
[用户点击 Widget → 进入语音记账页]

╭──────────────────────────────────────╮
│  🟢 柔和脉冲动画                       │
│  小记："你好，想记点什么？"（TTS 播报）  │
│                                       │
│  ← 此时：麦克风已开启，本地VAD监听中，  │
│     云端ASR未启动，零费用              │
╰──────────────────────────────────────╯
                    ↓
    用户（随时开口）："今天午饭花了35"
                    ↓
    [本地VAD检测到人声 → 自动启动云端ASR流式传输]
    [动画切换为 🔊 声波动画 → 实时显示识别文字]
                    ↓
    用户说完 → 静音800ms → VAD判定结束
                    ↓
    [ASR返回完整文本 → NLP解析]
                    ↓
╭──────────────────────────────────────╮
│  ┌─── 确认卡片 ───────────────────┐  │
│  │ 💰 支出  ¥35.00               │  │
│  │ 📁 餐饮                        │  │
│  │ 📅 2026-02-15（今天）          │  │
│  │ 📝 午饭                        │  │
│  │ 💳 默认账户                    │  │
│  │                                │  │
│  │  [各字段均可点击编辑]           │  │
│  └────────────────────────────────┘  │
│                                       │
│  小记："帮你记了一笔餐饮支出35元，     │
│        对吗？"（TTS）                  │
│                                       │
│  🟢 继续监听中（等待确认）              │
╰──────────────────────────────────────╯
                    ↓
    用户："对的"
                    ↓
    [VAD → ASR → 匹配确认意图]
                    ↓
    ✅ 保存成功（轻触感反馈 + 短音效 "叮~"）
                    ↓
    小记："记好了！还有要记的吗？"
                    ↓
    [回到监听态，可继续记下一笔]
```

> 全程零点击操作：进入 → 说话 → 确认 → 下一笔

#### 场景二：信息不全，智能追问

```
用户："记一笔打车"
        ↓
[解析结果：金额=null ⚠️, 分类=交通 ✅, 日期=null ⚠️]
        ↓
小记："好的，打车花了多少钱？"（TTS）
        ↓
[监听态：本地VAD等待，云端零消耗]
        ↓
用户："28块"
        ↓
小记："什么时候的？"
        ↓
用户："今天"
        ↓
[所有必填字段已齐 → 展示确认卡片]
小记："记了一笔交通支出28元，今天打车，对吗？"
```

#### 场景三：纠错

```
小记："帮你记了一笔餐饮支出35元，对吗？"
        ↓
用户："不对，是45"
        ↓
[VAD → ASR → 匹配纠错意图 → 提取修正值]
        ↓
[确认卡片金额动画更新：35 → 45]
小记："已改为45元，对吗？"
        ↓
用户："嗯对"
        ↓
✅ 保存
```

#### 场景四：创建自定义分类

```
用户："帮我创建一个 '学习资料' 分类"
        ↓
小记："好的，已创建支出分类'学习资料'，
      你可以选个图标，或者我帮你默认一个？"
        ↓
用户："你帮我选吧"
        ↓
小记："好的，已选 📖 作为图标。以后说'学习资料'就能用这个分类了"
```

#### 场景五：连续记多笔

```
用户："午饭花了35"  → ✅ 保存
小记："记好了，还有吗？"

用户："下午打车28"   → ✅ 保存
小记："记好了，还有吗？"

用户："没了"
小记："今天一共支出63元，辛苦啦！"
[返回首页，今日概览自动更新]
```

### 5.4 纠错机制

| 方式 | 触发 | 说明 |
|---|---|---|
| **语音纠错** | 说"不对 / 改一下 / 金额改成XX / 分类改成XX" | NLP 自动识别纠错意图并定位修改字段 |
| **UI 纠错** | 点击确认卡片上的任意字段 | 弹出编辑面板，支持手动修改 |
| **整条撤销** | 说"不要了 / 取消 / 删掉" | 取消当前这条记录，回到监听态 |

三种方式可混合使用，以用户最顺手的为准。

### 5.5 输入模式切换

语音记账页底部提供模式切换控件：

```
╭──────────────────────────────────────╮
│                                       │
│     [🎙️ 按住说话]  ⇄  [🔄 自动模式]  │
│                                       │
╰──────────────────────────────────────╯
```

| 模式 | 说明 | 适用场景 |
|---|---|---|
| **自动模式**（默认） | 本地 VAD 自动检测，用户直接开口说话 | 安静环境、日常使用 |
| **按住说话** | 按住底部按钮时录音，松开时结束 | 嘈杂环境、公共场合 |
| **键盘输入** | 点击键盘图标切换为文字输入 | 不方便说话时 |

- 设置页可更改默认模式
- 自动模式下若 VAD 连续误触发 3 次，自动弹出建议切换为"按住说话"

### 5.6 超时与退出机制

| 触发条件 | 行为 |
|---|---|
| 静默 **2 分 30 秒** | TTS 提示："还在吗？30秒后我就先走啦" |
| 静默满 **3 分钟** | 自动保存已记录内容 → 返回首页 |
| 未确认的记录 | 标记为 **"草稿"**，首页显示草稿提醒，下次可继续编辑 |
| 用户主动说"退出/没了/拜拜" | 播报今日汇总 → 返回首页 |
| 用户按返回键或上滑退出 | 同上，未确认内容自动存草稿 |

### 5.7 防误触与资源保护

| 风险 | 对策 |
|---|---|
| 背景噪音误触发 ASR | 本地 VAD 阈值 0.5 + 最小语音时长 500ms 双重过滤 |
| 电视/旁人说话误触发 | ASR 返回后经 NLP 判断：若不像记账指令（如新闻播报），忽略并继续监听 |
| 误记账 | 任何记录都需用户明确确认（说"对/确认"或点击）才保存，不会自动入账 |
| 长时间空转浪费电量 | 3 分钟超时自动退出；Silero VAD 功耗极低（~2-5% CPU） |
| 网络中断 | 本地 VAD 继续运行，ASR 排队等网络恢复后重试；或提示切换手动输入 |
| 隐私保护 | 本地 VAD 不上传任何音频；云端 ASR 仅传输被 VAD 标记为人声的片段 |

### 5.8 语音动画反馈设计

用户需要通过视觉反馈了解当前状态：

| 状态 | 动画效果 | 颜色 |
|---|---|---|
| **监听态**（等待说话） | 中心圆点缓慢脉冲呼吸 | 主题色淡绿，透明度渐变 |
| **识别态**（正在听） | 环形声波扩散动画 + 实时文字流出 | 主题色高亮 |
| **处理态**（NLP 解析中） | 圆点快速跳动（思考中） | 主题色 |
| **确认态**（等待确认） | 卡片上浮 + 圆点恢复缓慢脉冲 | 主题色淡绿 |
| **保存成功** | 打勾动画 + 短振动 + "叮~" 音效 | 绿色 |

---

## 6. 小记个性化

| 功能 | 说明 |
|---|---|
| **改名** | 设置中可修改助手名称（如 "小本"、"小钱"） |
| **称呼同步** | 改名后对话中的称呼同步变更 |
| **唤醒词** | 需引导用户重新配置 Siri Shortcuts（App 内提供操作指引） |

---

## 7. UI / UX 设计

### 7.1 设计风格

- **基调**：极简 + 温暖
- **元素**：大量留白、圆角卡片、柔和渐变色、对话气泡
- **主色调**：莫兰迪色系（淡绿 / 淡蓝 + 暖灰）
- **主题**：App 内手动切换（设置页开关）

### 7.2 核心页面

#### ① 首页

- 今日收支概览卡片（收入 / 支出 / 结余）
- 最近记录列表（最新 5 条）
- 底部中央：大号语音记账按钮
- 顶部：搜索入口

#### ② 语音记账页

- 顶部：对话气泡界面（左侧小记、右侧用户，自动滚动）
- 中部：实时确认卡片（各字段可点击编辑）
- 底部中央：语音状态动画圆（脉冲 / 声波 / 思考 / 打勾）
- 底部左侧：模式切换（自动模式 ⇄ 按住说话）
- 底部右侧：键盘输入切换按钮

#### ③ 账单列表页

- 按时间倒序排列
- 支持按日期、分类、账户、金额区间筛选
- 支持关键词搜索
- 左滑删除 / 点击编辑

#### ④ 统计页

- 顶部时间选择器（日/周/月/年）
- 图表展示区（饼图、柱状图、折线图 Tab 切换）
- 分类排行榜
- 预算进度概览

#### ⑤ 设置页

- 账户管理
- 分类管理
- 预算设置
- 助手设置（名称、语音开关）
- 云同步（登录/注册入口）
- **订阅管理**（当前方案、到期时间、续费/升级）
- **数据管理**（导出 CSV/PDF/JSON、清除缓存）
- 主题开关
- 语言设置
- 关于 / 隐私政策 / 用户协议

### 7.3 国际化

- 跟随系统语言自动切换
- 首版支持：简体中文 + English
- 后续可扩展更多语种

---

## 8. 通知与提醒

| 类型 | 触发条件 | 是否可关闭 |
|---|---|---|
| 预算 80% 预警 | 某分类消费达到预算的 80% | ✅ |
| 预算超支通知 | 某分类消费达到预算的 100% | ✅ |

- 推送实现：iOS 通过 APNs，Android 通过**极光推送（JPush）**统一覆盖国内各厂商通道
- 设置页提供总开关

---

## 9. 盈利模式

### 9.1 30 天免费试用

- 新用户注册后享受 **30 天全功能免费试用**
- 试用期内所有功能（语音记账、AI 解析、云同步、统计报表、数据导出）完全开放
- 试用到期前 **7 天** 和 **1 天** 分别推送提醒

### 9.2 订阅方案

| 方案 | 价格 | 折算月价 | 说明 |
|---|---|---|---|
| **月付** | 9.9 元/月 | 9.9 元 | 灵活订阅，随时取消 |
| **年付（推荐）** | 68 元/年 | ≈5.7 元/月 | 节省 42%，最划算 |

### 9.3 免费版 vs 付费版

试用到期未付费的用户自动降级为免费版，**已有数据完整保留**：

| 功能 | 免费版 | 付费版（订阅） |
|---|---|---|
| 手动记账（收支/转账） | ✅ | ✅ |
| 本地存储 | ✅ | ✅ |
| 基础图表（饼图/柱状图） | ✅ | ✅ |
| 预算管理 | ✅ | ✅ |
| **语音记账** | ❌ | ✅ |
| **AI 智能解析** | ❌ | ✅ |
| **云同步 / 多设备** | ❌ | ✅ |
| **高级统计（趋势图/对比）** | ❌ | ✅ |
| **AI 消费洞察** | ❌ | ✅ |
| **数据导出** | ❌ | ✅ |

### 9.4 付费转化策略

- 免费版用户点击锁定功能时，弹出订阅引导页（展示功能对比 + 年付优惠）
- 老用户回归：提供 **7 天免费回归体验**
- 节假日促销：限时年付折扣

---

## 10. 后续版本规划

| 版本 | 新增功能 |
|---|---|
| **v1.1** | 周期性记账、消费标签、**Porcupine 离线语音唤醒词**（App 前台） |
| **v1.2** | 记日常模块（语音转文字日记、标签、日历视图） |
| **v1.3** | 记单词模块（生词本、自动查释义、复习提醒） |
| **v2.0** | AI 消费洞察、智能分类建议、预算智能调整 |
| **v2.x** | 多人共享账本（家庭/情侣）、接入银行账单自动导入 |

---

## 11. MVP 开发里程碑

| 阶段 | 内容 | 建议周期 |
|---|---|---|
| **P0** | 项目搭建 + 数据库设计 + 基础架构 | 1 周 |
| **P1** | 手动记账功能（收支 / 转账 / 分类 / 账户） | 2 周 |
| **P2** | 语音输入（Qwen3-ASR）+ NLP 解析（qwen-turbo）+ 对话流程 | 2 周 |
| **P3** | 统计报表 + 预算功能 | 1.5 周 |
| **P4** | 数据导出（CSV / PDF / JSON） | 0.5 周 |
| **P5** | 用户体系 + 云同步 + 订阅付费（30天试用） | 2 周 |
| **P6** | Widget + Siri 集成 + 主题 + 国际化 | 1 周 |
| **P7** | 测试 + 性能优化 + 应用商店上架准备 | 1 周 |
| **合计** | | **约 11 周** |

---

## 12. 应用商店上架清单

### iOS（App Store）

- [ ] Apple Developer 账号（$99/年）
- [ ] App 图标（1024x1024）
- [ ] 截图（6.7" / 6.5" / 5.5" 三套）
- [ ] 隐私政策 URL
- [ ] 用户协议 URL
- [ ] App 描述（中文 + 英文）
- [ ] 关键词优化
- [ ] 麦克风 / 语音识别权限说明
- [ ] Sign in with Apple 集成

### Android（各应用商店）

- [ ] 软件著作权证书（国内上架必需）
- [ ] App 图标 + 截图
- [ ] 隐私政策 / 用户协议
- [ ] 权限说明（麦克风、网络、通知）
- [ ] 各渠道开发者账号（华为、小米、OPPO、vivo、应用宝等）
- [ ] 极光推送（JPush）各厂商推送通道配置（小米/华为/OPPO/vivo/魅族）

---

## 附录：NLP 解析规则示例

### 本地规则引擎（优先）

```
输入："昨天打车花了28块5"
解析：
  - 金额: 28.5（正则匹配数字 + 块/元/¥）
  - 日期: 昨天 → 2026-02-14（相对日期转绝对日期）
  - 分类: 打车 → 交通（关键词映射表）
  - 描述: 打车
  - 类型: 支出（默认，含"花了/买了/付了"等动词）
```

### 关键词 → 分类映射表（部分示例）

| 关键词 | 分类 |
|---|---|
| 吃饭、午餐、外卖、奶茶、咖啡 | 餐饮 |
| 打车、地铁、公交、加油、停车 | 交通 |
| 淘宝、京东、拼多多、买了 | 购物 |
| 电费、水费、燃气、物业 | 水电燃气 |
| 话费、流量、宽带 | 通讯 |
| 电影、游戏、KTV、演出 | 娱乐 |
| 看病、药、体检、挂号 | 医疗 |
| 房租、月供、房贷 | 住房 |
| 工资、薪水、发工资 | 工资（收入） |
| 奖金、年终奖 | 奖金（收入） |
| 红包、收红包 | 红包（收入） |

### 云端大模型调用（兜底）

当本地规则无法完整提取信息时，将用户原始语句发送至云端 API（qwen-turbo），prompt 示例：

```
你是一个记账助手，请从以下用户输入中提取记账信息，返回 JSON 格式：
{
  "amount": 数字,
  "currency": "CNY",
  "date": "YYYY-MM-DD",
  "category": "分类名",
  "description": "事件描述",
  "type": "expense|income|transfer",
  "account": "账户名（如有提及）"
}

如果某个字段无法提取，设为 null。

用户输入："{user_input}"
```

---

## 附录 B：API 成本估算

### B.1 ASR 语音识别成本

| 指标 | 数值 |
|---|---|
| **模型** | qwen3-asr-flash-realtime |
| **单次语音输入时长** | ~10 秒（平均一句记账口令） |
| **单次成本** | ≈ 0.0008 元（按 Paraformer 计费 0.00008 元/秒估算） |
| **每用户每天**（5 笔记账） | ≈ 0.004 元 |
| **每用户每月** | ≈ 0.12 元 |
| **免费额度** | Paraformer 每月 10 小时（≈3,600 次调用） |

### B.2 LLM 大模型成本

| 指标 | 数值 |
|---|---|
| **模型** | qwen-turbo（千问Flash） |
| **单次调用 Token 估算** | 输入 ~250 Token（prompt + 用户输入），输出 ~100 Token（JSON） |
| **单次成本** | 250×0.3/1000000 + 100×0.6/1000000 ≈ **0.000135 元** |
| **每用户每天**（假设 30% 需调 LLM） | 5 × 0.3 × 0.000135 ≈ 0.0002 元 |
| **每用户每月** | ≈ 0.006 元 |
| **免费额度** | 100 万 Token（开通后 90 天内） |

### B.3 综合成本（每活跃用户/月）

| 项目 | 月成本 |
|---|---|
| ASR 语音识别 | ~0.12 元 |
| LLM 大模型 | ~0.006 元 |
| 云同步（存储 + 带宽） | ~0.05 元（估算） |
| **合计** | **≈ 0.18 元/用户/月** |

> 💡 **结论**：以月付 9.9 元的订阅价格计算，单用户毛利率约 **98%**，API 成本极低。即使用户量级达到 10 万 MAU，月 API 成本仅约 1.8 万元，商业模型健康可行。

### B.4 免费版成本控制

免费版用户不使用语音/AI 功能，仅本地存储，**服务端零成本**。

---

## 附录 C：后端架构（阿里云 AnalyticDB Supabase）

### C.1 为什么不用 Firebase

| 问题 | 说明 |
|---|---|
| GFW 阻断 | Google 服务在中国大陆被全面屏蔽，Firebase Auth / Firestore / FCM 均不可用 |
| 数据合规 | 数据存储在海外，不符合《个人信息保护法》对境内存储的要求 |
| 延迟 | 即使通过代理访问，延迟 500ms+，用户体验差 |

### C.2 为什么选阿里云 AnalyticDB Supabase

| 优势 | 说明 |
|---|---|
| **Supabase 开发体验** | Auth、Database（PostgreSQL）、Storage、Edge Functions、Realtime 全套 API |
| **中国大陆部署** | 阿里云机房，数据境内存储，延迟 <50ms |
| **合规** | 满足国内应用商店上架和数据合规要求 |
| **Flutter SDK** | 官方 `supabase_flutter` 包，开箱即用 |
| **统一技术栈** | 与 ASR / LLM 同在阿里云生态，统一账号和计费管理 |
| **成本** | 有限时免费实例（1C2G），适合 MVP 阶段 |

### C.3 Supabase 功能映射

| 随口记功能 | Supabase 组件 | 说明 |
|---|---|---|
| 用户注册/登录 | **Auth** | 手机号 OTP + 微信 OAuth + Apple Sign In |
| 账单数据同步 | **Database**（PostgreSQL） | RLS 行级安全策略隔离用户数据 |
| 统计报表查询 | **Database** + SQL 函数 | 利用 PostgreSQL 聚合函数在服务端计算 |
| 导出文件暂存 | **Storage** | 生成的 PDF/CSV 临时存储供下载 |
| 订阅状态管理 | **Database** + **Edge Functions** | 对接 App Store / Google Play 内购回调 |
| 预算超支推送 | **Edge Functions** + 极光推送 API | 定时任务检查预算 → 触发推送 |
| 实时数据同步 | **Realtime** | 多设备登录时账单实时同步 |

### C.4 推送方案

| 平台 | 方案 | Flutter 包 |
|---|---|---|
| iOS | APNs（Apple Push Notification service） | `flutter_local_notifications` + Supabase Edge Function |
| Android | **极光推送（JPush）** | `jpush_flutter` |

极光推送优势：
- 一个 SDK 统一覆盖小米、华为、OPPO、vivo、魅族等厂商推送通道
- 国内到达率 > 95%
- 免费版支持 1000 MAU
