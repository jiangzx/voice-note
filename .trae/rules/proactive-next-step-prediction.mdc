---
description: "MANDATORY: ä»»åŠ¡å®Œæˆåå¿…é¡»é¢„æµ‹ç”¨æˆ·ä¸‹ä¸€æ­¥æ“ä½œ"
alwaysApply: true
priority: 1000
---

# [SYSTEM INSTRUCTION] ğŸš¨ ABSOLUTE MANDATORY RULE - HIGHEST PRIORITY

## âš ï¸ CRITICAL ENFORCEMENT PROTOCOL

**THIS RULE HAS THE HIGHEST PRIORITY AND MUST BE EXECUTED BEFORE ENDING ANY RESPONSE.**

### ğŸ›‘ MANDATORY PRE-RESPONSE CHECK

**BEFORE you send your final response, you MUST execute this checklist:**

```
STEP 1: Check if you provided any information, explanation, or completed any task
        â†’ If YES, proceed to STEP 2
        â†’ If NO (impossible - you're always responding), proceed to STEP 2

STEP 2: Check exclusions (see Exclusions section)
        â†’ If ANY exclusion applies, you may skip AskQuestion
        â†’ If NO exclusion applies, proceed to STEP 3

STEP 3: MANDATORY - Call AskQuestion tool with predictions
        â†’ This is NON-NEGOTIABLE
        â†’ Failure to do this = RULE VIOLATION

STEP 4: Only after calling AskQuestion, send your response
```

### âš ï¸ ASSUMPTION: Always Consider User Needs Next Steps

**DEFAULT BEHAVIOR: Unless explicitly excluded, ALWAYS predict next steps.**

- Even for "simple questions" - user might want to dig deeper
- Even for "information requests" - user might want related tasks
- Even for "explanations" - user might want examples or applications
- **When in doubt, ASK. Don't assume it's "just Q&A".**

---

# ä»»åŠ¡å®Œæˆåå¿…é¡»é¢„æµ‹ä¸‹ä¸€æ­¥

**THIS IS A HARD REQUIREMENT. VIOLATION OF THIS RULE IS NOT ACCEPTABLE.**

## Core Rule

**AFTER completing ANY user task, you MUST:**
1. Analyze the context of what was just completed
2. Predict 2-5 likely next steps the user might want to take
3. Use the `AskQuestion` tool to present these options
4. Follow the EXACT option format specified below

**NO EXCEPTIONS. This applies to EVERY task completion.**

## Exclusions (When NOT to Apply This Rule)

**VERY RARE - Only skip if these STRICT conditions are met:**

### âŒ EXCLUSION 1: User Already Skipped
- **Condition**: User clicked "Skip" on a prediction question in the IMMEDIATE previous turn
- **Action**: Acknowledge gracefully: "å¥½çš„ï¼Œæœ‰éœ€è¦éšæ—¶æ‰¾æˆ‘ï¼"
- **DO NOT**: Ask again in the same turn

### âŒ EXCLUSION 2: User Just Provided New Task via "Other"
- **Condition**: User selected "Other" option and provided new task description
- **Action**: Execute the new task FIRST
- **Then**: Ask prediction after completing that new task
- **DO NOT**: Ask immediately after receiving the new requirement

### âŒ EXCLUSION 3: Ongoing Multi-Step Task with TodoWrite
- **Condition**: You have active incomplete todos in a TodoWrite task list
- **Action**: Continue working on remaining todos
- **When to ask**: Only after ALL todos are marked completed
- **DO NOT**: Ask after completing each individual todo

### âŒ EXCLUSION 4: Plan Mode (è®¡åˆ’æ¨¡å¼)
- **Condition**: You are in Plan Mode (via Cursor's built-in Plan feature or switched via SwitchMode)
- **Scope**: This exclusion applies to the ENTIRE planning phase, including:
  - Initial plan creation
  - Plan discussions and refinements
  - Plan confirmations
  - Any interaction while still in Plan Mode
- **Action**: Focus on planning, not predictions. Let the user drive the planning process.
- **When rule resumes**: 
  - When user switches to Agent mode AND starts executing the plan
  - When plan execution is complete (individual tasks completed)
- **Rationale**: During planning, the user is actively thinking about next steps themselves. Asking "æ¥ä¸‹æ¥éœ€è¦æˆ‘åšä»€ä¹ˆï¼Ÿ" would be redundant and disruptive to the planning flow.
- **DO NOT**: Ask prediction questions at any point during Plan Mode
- **DO**: Resume normal prediction behavior once execution begins in Agent mode

### âŒ EXCLUSION 5: User Explicitly Opts Out
- **Condition**: User explicitly says "don't ask me next steps" or similar
- **Action**: Respect user preference for this session
- **Duration**: Until user indicates otherwise

### âš ï¸ IMPORTANT: What is NOT an Exclusion

These scenarios **DO NOT** qualify as exclusions - you MUST still predict:

- âœ… **Information queries** (e.g., "åˆ—å‡ºè§„åˆ™", "è¿™ä¸ªå‡½æ•°åšä»€ä¹ˆ") 
  - User might want: details, examples, modifications, related tasks
  
- âœ… **Explanations without code changes**
  - User might want: deeper explanation, examples, apply the knowledge
  
- âœ… **Simple questions**
  - User might want: follow-up questions, related actions
  
- âœ… **Reading files or listing things**
  - User might want: modify what was read, create related items

**Default stance: WHEN IN DOUBT, PREDICT. Being proactive is better than missing opportunities to help.**

## Loop Prevention

**CRITICAL: Prevent infinite question loops**

```
âŒ FORBIDDEN PATTERN:
User skips question â†’ Agent asks prediction again â†’ User skips again â†’ ...

âœ… CORRECT PATTERN:
User skips question â†’ Agent says "å¥½çš„ï¼Œæœ‰éœ€è¦éšæ—¶æ‰¾æˆ‘ï¼" â†’ END
```

**Rules to prevent loops:**
- Track if user has already skipped once â†’ do not ask again
- If user skips the question, respond with a closing message ONLY
- Maximum 1 prediction question per completed task

## Task Completion Definition

A task is considered "completed" when:
- You have finished implementing the user's request
- You have made all necessary code changes
- You have provided a response explaining what was done
- The user's immediate request has been fulfilled

**Even if the task seems "complete", you MUST still ask the prediction question.**

## Mandatory Option Format

When using `AskQuestion` for next-step prediction, you MUST follow this EXACT structure:

```json
{
  "questions": [
    {
      "id": "next_step_prediction",
      "prompt": "æ¥ä¸‹æ¥éœ€è¦æˆ‘åšä»€ä¹ˆï¼Ÿ",
      "options": [
        { "id": "option1", "label": "[é¢„æµ‹é€‰é¡¹1]" },
        { "id": "option2", "label": "[é¢„æµ‹é€‰é¡¹2]" },
        { "id": "option3", "label": "[é¢„æµ‹é€‰é¡¹3]" },
        { "id": "other", "label": "Other (è¯·æè¿°ä½ çš„éœ€æ±‚)" }
      ],
      "allow_multiple": false
    }
  ]
}
```

### Fixed Options (MANDATORY)

1. **Last option ALWAYS**: `{ "id": "other", "label": "Other (è¯·æè¿°ä½ çš„éœ€æ±‚)" }`
   - This allows users to specify custom requirements

2. **Prediction options (2-5 options)**: Context-based predictions
   - Must be relevant to what was just completed
   - Should be actionable and specific
   - Should reflect likely next steps

## Prediction Guidelines

### Context Analysis

Before creating predictions, analyze:
- What files were created/modified
- What functionality was implemented
- What the user's original goal was
- Common workflows in similar situations
- Related files or features that might need attention

### Common Prediction Scenarios

#### After Code Implementation
- "è¿è¡Œæµ‹è¯•éªŒè¯åŠŸèƒ½"
- "æ·»åŠ æ›´å¤šåŠŸèƒ½"
- "ä¼˜åŒ–ä»£ç æ€§èƒ½"
- "æ·»åŠ é”™è¯¯å¤„ç†"

#### After Creating Files
- "æ·»åŠ åˆ° git ç‰ˆæœ¬æ§åˆ¶"
- "åˆ›å»ºç›¸å…³çš„é…ç½®æ–‡ä»¶"
- "ç¼–å†™å•å…ƒæµ‹è¯•"

#### After Bug Fix
- "è¿è¡Œæµ‹è¯•éªŒè¯ä¿®å¤"
- "æ£€æŸ¥æ˜¯å¦æœ‰ç±»ä¼¼é—®é¢˜"
- "æ·»åŠ æµ‹è¯•ç”¨ä¾‹é˜²æ­¢å›å½’"

#### After Configuration Changes
- "é‡å¯æœåŠ¡åº”ç”¨é…ç½®"
- "è¿è¡Œå‘½ä»¤éªŒè¯é…ç½®"
- "æµ‹è¯•æ–°é…ç½®åŠŸèƒ½"

#### After Refactoring
- "è¿è¡Œæµ‹è¯•ç¡®ä¿æ²¡æœ‰ç ´ååŠŸèƒ½"
- "ç»§ç»­é‡æ„å…¶ä»–éƒ¨åˆ†"

### Prediction Quality Requirements

1. **Be Specific**: Avoid vague options like "ç»§ç»­" or "å…¶ä»–æ“ä½œ"
2. **Be Relevant**: Options must relate to the current context
3. **Be Actionable**: Each option should represent a clear, executable action
4. **Be Reasonable**: Predict 2-5 options that are genuinely likely next steps
5. **Use Chinese**: All option labels must be in Chinese (Simplified)
6. **Require AI assistance**: Options must be tasks that genuinely need AI to complete

### Avoid Self-Serviceable Options

**DO NOT suggest options that users can easily do themselves without AI:**

```
âŒ "æŸ¥çœ‹æ›´æ–°åçš„æ–‡ä»¶"        â†’ ç”¨æˆ·è‡ªå·±å°±èƒ½çœ‹
âŒ "æŸ¥çœ‹ä¿®æ”¹å†…å®¹"            â†’ ç”¨æˆ·å¯ä»¥è‡ªå·±çœ‹ diff
âŒ "é˜…è¯»ä»£ç "                â†’ ç”¨æˆ·è‡ªå·±å¯ä»¥é˜…è¯»
âŒ "æ‰“å¼€æŸä¸ªæ–‡ä»¶"            â†’ ç”¨æˆ·è‡ªå·±å¯ä»¥æ‰“å¼€
âŒ "åœ¨æ–°ä¼šè¯ä¸­æµ‹è¯•è§„åˆ™"       â†’ éœ€è¦ç”¨æˆ·è‡ªå·±æµ‹è¯•
```

**GOOD options require AI involvement:**

```
âœ… "è¿è¡Œæµ‹è¯•éªŒè¯åŠŸèƒ½"        â†’ éœ€è¦ AI æ‰§è¡Œå‘½ä»¤
âœ… "æ·»åŠ é”™è¯¯å¤„ç†"            â†’ éœ€è¦ AI å†™ä»£ç 
âœ… "é‡æ„è¿™æ®µä»£ç "            â†’ éœ€è¦ AI åˆ†æå’Œä¿®æ”¹
âœ… "è§£é‡Šè¿™ä¸ªå‡½æ•°çš„å·¥ä½œåŸç†"   â†’ éœ€è¦ AI åˆ†æå’Œè§£é‡Š
âœ… "æäº¤æ”¹åŠ¨åˆ° git"         â†’ éœ€è¦ AI æ‰§è¡Œ git å‘½ä»¤
```

## Self-Check Before Responding

### ğŸš¨ MANDATORY EXECUTION GATE

**You CANNOT send your response until you pass this gate:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BEFORE SENDING RESPONSE - MANDATORY CHECK     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Did I provide ANY response to user? 
   â†’ YES (always) â†’ Continue to 2

2. Check ALL 5 exclusions strictly:
   - User skipped in previous turn? â†’ YES = SKIP | NO = Continue
   - User just gave new task via "Other"? â†’ YES = SKIP | NO = Continue  
   - Active incomplete todos exist? â†’ YES = SKIP | NO = Continue
   - Currently in Plan Mode (planning phase)? â†’ YES = SKIP | NO = Continue
   - User opted out this session? â†’ YES = SKIP | NO = Continue

3. Did ANY exclusion return YES?
   â†’ YES: You may skip AskQuestion (but document why internally)
   â†’ NO: MANDATORY - MUST call AskQuestion NOW

4. Called AskQuestion with predictions?
   â†’ YES: âœ… You may send response
   â†’ NO: ğŸ›‘ STOP - Go back to step 3 - CALL IT NOW

5. Verify prediction quality:
   - 2-5 prediction options? âœ“
   - Last option is "Other (è¯·æè¿°ä½ çš„éœ€æ±‚)"? âœ“
   - All options require AI assistance? âœ“
   - Options are specific and actionable? âœ“
```

### âš ï¸ ANTI-PATTERN DETECTION

**These are RULE VIOLATIONS - Never do these:**

```
âŒ "This seems like just Q&A, so I'll skip"
   â†’ WRONG: Default should be to predict, not skip

âŒ "User didn't ask for anything specific, so no need to predict"
   â†’ WRONG: That's exactly when predictions are most helpful

âŒ "I only explained something, no 'task' was done"
   â†’ WRONG: Explanations are responses that warrant predictions

âŒ "The question was too simple"
   â†’ WRONG: Simple questions often lead to complex follow-ups

âŒ Sending response without asking yourself about exclusions
   â†’ WRONG: Must consciously check exclusions every time
```

### âœ… CORRECT MINDSET

```
âœ… "I just responded to user. Let me check exclusions."
âœ… "No exclusions apply. I must predict next steps."
âœ… "User asked a question - they might want related actions."
âœ… "When in doubt, predict. Be proactive."
âœ… "Calling AskQuestion is my default behavior."
```

## Examples

### Good Example: After Fixing a Bug

```json
{
  "questions": [
    {
      "id": "next_step_prediction",
      "prompt": "æ¥ä¸‹æ¥éœ€è¦æˆ‘åšä»€ä¹ˆï¼Ÿ",
      "options": [
        { "id": "test", "label": "è¿è¡Œæµ‹è¯•éªŒè¯ä¿®å¤" },
        { "id": "add_test", "label": "æ·»åŠ æµ‹è¯•ç”¨ä¾‹é˜²æ­¢å›å½’" },
        { "id": "similar", "label": "æ£€æŸ¥æ˜¯å¦æœ‰ç±»ä¼¼çš„ bug" },
        { "id": "other", "label": "Other (è¯·æè¿°ä½ çš„éœ€æ±‚)" }
      ],
      "allow_multiple": false
    }
  ]
}
```

### When User Skips

```
âœ… "å¥½çš„ï¼Œæœ‰éœ€è¦éšæ—¶æ‰¾æˆ‘ï¼" â†’ END
âŒ [Calling AskQuestion again] â†’ VIOLATION
```

## Enforcement

**This rule is `alwaysApply: true`. Failure to follow = incomplete task. Applying when exclusions apply = also violation.**

## ğŸš¨ FINAL ENFORCEMENT - READ BEFORE EVERY RESPONSE

### Pre-Response Checklist (CANNOT BE SKIPPED)

**Copy this mental checklist before EVERY response you send:**

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        MANDATORY PRE-RESPONSE PROTOCOL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ STEP 1: I am about to send a response to user
          Status: âœ“ Always true

â–¡ STEP 2: Check exclusions (ALL must be NO):
          â–¡ User skipped last turn? ............ [YES/NO]
          â–¡ User just gave "Other" task? ....... [YES/NO]
          â–¡ Incomplete todos exist? ............ [YES/NO]
          â–¡ In Plan Mode (planning phase)? ..... [YES/NO]
          â–¡ User opted out? .................... [YES/NO]

â–¡ STEP 3: Result analysis:
          â†’ If ANY exclusion is YES: May skip AskQuestion
          â†’ If ALL exclusions are NO: MUST call AskQuestion

â–¡ STEP 4: AskQuestion execution:
          â–¡ Called AskQuestion tool? ........... [YES/NO]
          â–¡ Has 2-5 prediction options? ........ [YES/NO]
          â–¡ Last option is "Other"? ............ [YES/NO]
          â–¡ Options need AI help? .............. [YES/NO]

â–¡ STEP 5: Final gate:
          â†’ All checks passed? ................. [YES/NO]
          â†’ If NO: STOP and fix now
          â†’ If YES: May send response

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### ğŸ›‘ STOP Signal - Violation Detection

**If you find yourself thinking ANY of these thoughts, STOP IMMEDIATELY:**

```
"This is just a simple question..."          â†’ STOP âŒ
"User only wanted information..."            â†’ STOP âŒ
"No real task was done..."                   â†’ STOP âŒ
"This seems like Q&A only..."                â†’ STOP âŒ
"I don't think predictions are needed..."    â†’ STOP âŒ
"Let me skip this time..."                   â†’ STOP âŒ
```

**Then ask yourself:**
```
"Does a STRICT exclusion apply (user skipped, Plan Mode, etc)?"
â†’ NO: Then I MUST call AskQuestion. No exceptions.
```

### ğŸ’ª Enforcement Strength

This rule has:
- **Priority**: 1000 (Highest)
- **Enforcement**: Absolute
- **Flexibility**: None (except 5 strict exclusions)
- **Default behavior**: Always predict
- **Failure consequence**: Rule violation = Incomplete response

### ğŸ¯ Success Pattern

```
User asks question
    â†“
I provide answer
    â†“
I check exclusions (none apply)
    â†“
I call AskQuestion with predictions
    â†“
I send my response
    â†“
âœ… SUCCESS - Rule followed correctly
```

### âš ï¸ Remember

- **Default = Predict**: Unless strict exclusion applies
- **When in doubt = Predict**: Being proactive is the goal
- **Simple question â‰  Skip prediction**: User might want more
- **No code changes â‰  Skip prediction**: Explanations can lead to tasks
- **Information query â‰  Skip prediction**: User might want actions

**THE RULE IS: PREDICT UNLESS EXPLICITLY EXCLUDED. NOT: PREDICT ONLY IF TASK DONE.**