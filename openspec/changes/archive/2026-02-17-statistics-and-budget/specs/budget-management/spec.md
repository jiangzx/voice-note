## ADDED Requirements

### Requirement: 按分类设置月度预算
系统 SHALL 支持为每个支出分类设置月度预算金额。每个分类每月最多 SHALL 有一条预算记录。预算金额 SHALL 为正数。收入分类和转账 SHALL NOT 支持预算。

#### Scenario: 设置餐饮月度预算
- **WHEN** 用户为"餐饮"分类设置 2026 年 2 月预算为 ¥2000
- **THEN** 系统 SHALL 创建预算记录（category_id=餐饮, amount=2000, year_month="2026-02"）

#### Scenario: 修改已有预算
- **WHEN** 用户将"餐饮"的 2026 年 2 月预算从 ¥2000 修改为 ¥2500
- **THEN** 系统 SHALL 更新该预算记录的 amount 为 2500

#### Scenario: 删除预算
- **WHEN** 用户删除"餐饮"的月度预算
- **THEN** 系统 SHALL 移除该预算记录

#### Scenario: 拒绝零或负数预算
- **WHEN** 用户尝试设置预算金额为 0 或负数
- **THEN** 系统 SHALL 拒绝操作

#### Scenario: 收入分类不支持预算
- **WHEN** 用户尝试为"工资"（收入分类）设置预算
- **THEN** 系统 SHALL NOT 提供预算设置入口

### Requirement: 预算进度实时追踪
系统 SHALL 实时展示每个有预算的分类的消费进度。进度 SHALL 为当月该分类已消费金额 / 预算金额。进度条 SHALL 根据消费比例变化颜色：0-79% 绿色、80-99% 黄色、100%+ 红色。

#### Scenario: 正常消费
- **WHEN** 用户"餐饮"预算 ¥2000，当月已消费 ¥800
- **THEN** 系统 SHALL 展示进度 40%（绿色）

#### Scenario: 接近预算
- **WHEN** 用户"餐饮"预算 ¥2000，当月已消费 ¥1700
- **THEN** 系统 SHALL 展示进度 85%（黄色）

#### Scenario: 超出预算
- **WHEN** 用户"餐饮"预算 ¥2000，当月已消费 ¥2300
- **THEN** 系统 SHALL 展示进度 115%（红色）

### Requirement: 预算超支提醒
系统 SHALL 在消费达到预算 80% 和 100% 时通过本地通知提醒用户。每个分类每月每个阈值（80%/100%）最多 SHALL 触发一次通知。

#### Scenario: 80% 预警通知
- **WHEN** 用户保存一笔交易后，"餐饮"分类消费首次达到预算的 80%
- **THEN** 系统 SHALL 发送本地通知："餐饮预算已使用 80%，请注意控制消费"

#### Scenario: 100% 超支通知
- **WHEN** 用户保存一笔交易后，"餐饮"分类消费首次达到预算的 100%
- **THEN** 系统 SHALL 发送本地通知："餐饮预算已超支，本月已消费 ¥XXXX / 预算 ¥2000"

#### Scenario: 不重复通知
- **WHEN** "餐饮"分类当月已触发过 80% 预警通知，用户再次消费但仍在 80-99% 范围
- **THEN** 系统 SHALL NOT 再次发送 80% 预警通知

### Requirement: 预算概览页
系统 SHALL 提供预算概览页，展示所有有预算的分类的当月消费进度。SHALL 支持从概览页快速跳转至预算编辑页。未设置预算的分类 SHALL 以"未设定"状态展示在列表末尾。

#### Scenario: 展示预算概览
- **WHEN** 用户进入预算概览页且有 3 个分类设置了预算
- **THEN** 系统 SHALL 展示 3 个分类的预算进度条和消费金额

#### Scenario: 总预算汇总
- **WHEN** 用户有 3 个分类预算合计 ¥5000，当月总支出 ¥3000
- **THEN** 系统 SHALL 在页面顶部展示总预算 ¥5000、已消费 ¥3000、剩余 ¥2000

### Requirement: 预算编辑页
系统 SHALL 提供预算编辑页，用户可一次性为多个支出分类设置或修改预算金额。SHALL 展示所有支出分类（不含已隐藏的）。保存后 SHALL 持久化所有变更。

#### Scenario: 批量设置预算
- **WHEN** 用户在编辑页为"餐饮"设置 ¥2000、"交通"设置 ¥500，然后保存
- **THEN** 系统 SHALL 同时创建两条预算记录

#### Scenario: 清空某分类预算
- **WHEN** 用户在编辑页将"购物"的预算金额清空并保存
- **THEN** 系统 SHALL 删除"购物"的预算记录

### Requirement: 预算自动继承
系统 SHALL 支持预算自动继承：当新月份开始且未手动设置预算时，SHALL 自动复制上月的预算配置。继承逻辑 SHALL 在用户首次访问预算概览页或首次触发预算检查时执行（懒加载）。

#### Scenario: 自动继承上月预算
- **WHEN** 用户在 2026 年 3 月首次打开预算概览页，且 3 月未手动设置预算
- **THEN** 系统 SHALL 自动使用 2026 年 2 月的预算配置

#### Scenario: 手动覆盖继承
- **WHEN** 用户在 3 月手动修改了某分类的预算
- **THEN** 系统 SHALL 使用手动设置的值，其他未修改分类 SHALL 继续使用继承值

#### Scenario: 上月无预算
- **WHEN** 用户首次使用预算功能，上月（2 月）无任何预算记录
- **THEN** 系统 SHALL 展示空预算状态，提示用户设置预算

#### Scenario: 上月部分分类有预算
- **WHEN** 2 月仅"餐饮"和"交通"设置了预算，3 月首次访问
- **THEN** 系统 SHALL 仅继承"餐饮"和"交通"的预算，其他分类 SHALL 显示为"未设定"
