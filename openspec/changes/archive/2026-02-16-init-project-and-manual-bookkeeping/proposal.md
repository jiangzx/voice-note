## Why

随口记 App 是一款以语音对话为核心交互的智能记账助手，目前项目尚未启动，需要从零搭建项目基础设施并实现核心手动记账功能。P0（项目基础）+ P1（手动记账）是所有后续功能（语音输入、统计报表、云同步等）的基石——没有稳固的数据模型和基础记账能力，一切上层功能无从谈起。

## What Changes

- 搭建 Flutter 跨平台项目，建立分层架构（数据层 / 领域层 / 表现层）
- 引入 SQLite（via drift）作为本地持久化方案，设计核心数据模型
- 采用**本地优先架构**：首次使用无需登录，所有数据存储在本地 SQLite；数据模型预留用户标识与同步元数据字段，为后续登录后云同步做好准备
- 实现**账户管理**：采用渐进式披露设计，默认单账户体验（"钱包"），用户无需了解账户概念即可记账；高级用户可在设置中开启多账户功能（via shared_preferences 持久化）后自行添加微信/支付宝/银行卡等
- 实现**分类体系**：预定义支出分类（10 个可见 + 2 个初始隐藏）+ 收入分类（5 个）+ 用户自定义分类的增删改查、排序、图标（material: / emoji: 格式）/ 颜色（ARGB hex）标记；智能排序采用三层策略（最近使用快捷区域 + 时段推荐高亮 + 手动排序基准），自定义分类删除采用条件策略（无引用硬删除、有引用软删除）
- 实现**交易记录**：支出 / 收入 / 转账三种类型，必填字段仅**金额 + 分类**（日期自动填充今天可选改，描述可选填采用「Easy Capture, Smart Fallback」策略），默认人民币不支持多币种
- 实现**转账记录**：采用单账户视角，用户只需指定一个账户和资金方向（转入/转出），可选填对方信息（其他账户名或人名如"小明"）；支持单侧独立记录，无需强制指定双端；删除配对交易时自动解除对向关联
- 实现**交易查询**：按时间倒序列表，支持按日期、分类、账户、金额区间筛选和关键词搜索（匹配 description 字段）；首页收支汇总（转账不计入）+ 最近交易查询
- 采用**流水视角优先的余额策略**：默认不展示账户余额，首页展示时间段收支汇总；余额仅作为多账户模式下的可选参考值（标注"记账余额"非真实余额），accounts 表预留 initial_balance 字段

## Capabilities

### New Capabilities

- `data-model`：核心数据模型定义——账户（含 initial_balance 预留字段）、分类、交易记录等实体及其关系，默认人民币（多币种后续版本支持）。采用本地优先策略（首次使用无需登录，数据全部存本地），数据模型预留同步元数据（updated_at / sync_status / remote_id），icon 使用 `material:` / `emoji:` 前缀格式，color 使用 8 位 ARGB hex，为后续 P5 云同步做好结构准备
- `account-management`：账户生命周期管理——默认单账户初始化（"钱包"）、可选多账户功能开启（shared_preferences 持久化）、自定义账户增删改查、记账余额计算（流水视角优先，默认不展示余额）
- `category-management`：分类体系管理——预定义收支分类初始化、自定义分类增删改查（有引用时软删除）、三层智能排序（最近使用 + 时段推荐 + 手动排序）、图标与颜色配置、分类隐藏（预设分类不可删除但可隐藏）
- `transaction-recording`：交易记录管理——创建/编辑/删除支出、收入、转账记录（描述字段采用 Easy Capture Smart Fallback 策略），必填字段校验，转账采用单账户视角（单侧记录 + 可选对方信息 + 可选配对关联 + 删除时级联解除配对）
- `transaction-query`：交易查询与检索——按时间倒序展示、多维度筛选（日期/分类/账户/金额区间）、关键词搜索（匹配 description）、首页收支汇总（转账不计入）、最近交易查询、按日分组汇总

### Modified Capabilities

（无——项目从零开始，不存在已有 spec 需要修改）

## Impact

- **代码**：全新 Flutter 项目，包含完整的分层架构（数据层 drift ORM / 领域层 use case / 表现层状态管理）
- **依赖**：drift（SQLite ORM）、riverpod（状态管理）、shared_preferences（应用设置持久化）、intl（国际化基础）、uuid（唯一 ID 生成）
- **数据库**：SQLite 本地数据库，包含 accounts / categories / transactions 等核心表；所有表预留 sync 相关字段
- **架构约束**：本地优先（local-first）——App 必须在无网络、无账号状态下完整运行手动记账功能；后续登录后已有本地数据可无缝关联至云端用户
- **后续影响**：此数据模型将被语音记账（P2）、统计报表（P3）、数据导出（P4）、云同步（P5）等后续模块直接依赖
